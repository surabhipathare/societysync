const{__:__,_x:_x,_n:_n,_nx:_nx}=wp.i18n;export function moduleData(){return{props:{display:String,name:String,block:Object,contextualData:Object},data:function(){return{loading:!0,error:!1,apiLoaded:!1,errorMessage:"",total:0,comparisonTotal:0,percentChange:0,fetchingQuery:!1,requestFromGroupDate:!1,currentRequest:!1,startDate:"",endDate:"",currentData:[],chartData:{data:{main:[],comparison:[]},labels:{main:[],comparisons:[]},title:"",colors:{main:this.returnLineColor,comp:this.returnCompLineColor}},strings:{lastPeriod:__("last period","uipress-pro"),selectDataMetric:__("Please select a chart metric in this block's options to show chart data.","uipress-pro"),changeAccount:__("Switch account","uipress-pro"),count:__("Count","uipress-pro"),change:__("Change","uipress-pro"),sold:__("Sold","uipress-pro"),revenue:__("Revenue","uipress-pro")}}},inject:["uipData","uipress","uiTemplate"],watch:{"block.settings.block.options.chartDataType":{handler(t,e){this.currentRequest&&this.processResponse()}},"contextualData.groupDate":{handler(t,e){this.getAnalytics()},deep:!0},"uiTemplate.wooComnmerce.ready":{handler(t,e){this.getAnalytics()},deep:!0}},mounted:function(){this.getAnalytics()},computed:{returnTableData(){return this.currentData},returnTotal(){return this.total},returnComparisonTotal(){return this.comparisonTotal},returnChartData(){return this.chartData},returnName(){let t=this.uipress.get_block_option(this.block,"block","chartName",!0);return t?this.uipress.isObject(t)?"string"in t?t.string:void 0:t:""},returnChartType(){return this.uipress.get_block_option(this.block,"block","chartDataType")},returnLineColor(){return this.uipress.get_block_option(this.block,"block","chartColour")},returnCompLineColor(){return this.uipress.get_block_option(this.block,"block","chartCompColour")},hideChart(){return this.uipress.get_block_option(this.block,"block","hideChart")},inlineAccountSwitch(){return this.uipress.get_block_option(this.block,"block","inlineAccountSwitch")},returnClasses(){let t="";return t+=this.uipress.get_block_option(this.block,"advanced","classes")},returnRange(){let t=this.uipress.get_block_option(this.block,"block","dateRange");return t?isNaN(t)?14:t>60?60:t:14},hasGlobalDate(){return void 0!==this.contextualData&&(!!this.uipress.isObject(this.contextualData)&&("groupDate"in this.contextualData&&("start"in this.contextualData.groupDate&&"end"in this.contextualData.groupDate)))}},methods:{getAnalytics(){let t,e,r=this;r.loading=!0,r.error=!1,r.errorMessage="",r.uipress.isObject(r.uiTemplate.wooComnmerce)&&"ready"in r.uiTemplate.wooComnmerce&&r.uiTemplate.wooComnmerce.ready?(r.apiLoaded=!0,this.hasGlobalDate?(t=new Date(Date.parse(this.contextualData.groupDate.start)),e=new Date(Date.parse(this.contextualData.groupDate.end))):((e=new Date).setDate(e.getDate()-1),(t=new Date).setDate(t.getDate()-r.returnRange)),r.startDate=t,r.endDate=e,r.uiTemplate.wooComnmerce.api("get",t,e).then(t=>{if(t.error)return r.loading=!1,r.error=!0,void(r.errorMessage=t.message);r.loading=!1,r.currentRequest=t.data,r.processResponse()})):r.apiLoaded=!1},processResponse(){let t=this.currentRequest,e=this.returnChartType;e&&(this.currentData=t[e],console.log(this.currentData))},secondsToTime(t){if(isNaN(t))return 0;Math.floor(t/3600).toString().padStart(2,"0");const e=Math.floor(t%3600/60).toString().padStart(2,"0"),r=Math.floor(t%60).toString().padStart(2,"0");return 0==e?"0m "+r+"s":e+"m "+r+"s"},returnFormattedDate(t){if(!t||""==t)return"";let e=t.getMonth()+1,r=t.getDate(),i=t.getFullYear();return e<10&&(e="0"+e),r<10&&(r="0"+r),i+"/"+e+"/"+r},returnErrrorMessage(){try{JSON.parse(this.errorMessage)}catch(t){return this.errorMessage}if(this.uipress.isObject(JSON.parse(this.errorMessage))){let t=JSON.parse(this.errorMessage);return`\n              <h5 style="margin:0">${t.status}</h5>\n              <p style="margin-bottom:0;">${t.message}</p>\n            `}return this.errorMessage},returnSymbolTotal(t){let e=this;return"left"==e.currentRequest.currency_pos?e.currentRequest.currency+t:"left_space"==e.currentRequest.currency_pos?e.currentRequest.currency+" "+t:"right"==e.currentRequest.currency_pos?t+e.currentRequest.currency:"right_space"==e.currentRequest.currency_pos?t+" "+e.currentRequest.currency:t}},template:'\n\t\t  <div class="uip-flex uip-flex-column" :id="block.uid" :class="returnClasses">\n      <div class="uip-flex uip-flex-between">\n        <div class="uip-text-bold uip-margin-bottom-xxs uip-text-normal uip-chart-title">{{returnName}}</div>\n      </div>\n      <div class="uip-text-s uip-text-muted uip-margin-bottom-s uip-margin-bottom-s uip-dates">{{currentRequest.start_date}} - {{currentRequest.end_date}}</div>\n      <div v-if="loading" class="uip-padding-m uip-flex uip-flex-center uip-flex-middle uip-min-w-200 uip-w-100p uip-ratio-16-10 uip-border-box"><loading-chart></loading-chart></div>\n      <div v-else-if="error && errorMessage" class="uip-padding-xs uip-border-round uip-background-orange-wash uip-text-bold uip-margin-bottom-s uip-scale-in-top uip-max-w-100p" v-html="returnErrrorMessage()"></div>\n      <div v-else-if="!returnChartType" class="uip-padding-xxs uip-border-round uip-background-green-wash uip-text-green uip-text-bold uip-margin-bottom-s uip-scale-in-top uip-max-w-200">{{strings.selectDataMetric}}</div>\n      <div v-else class="uip-min-w-200">\n        <div class="uip-flex uip-flex-column uip-row-gap-xs">\n          <div class="uip-max-w-100p uip-overflow-auto uip-scrollbar">\n            <table class="uip-min-w-250 uip-w-100p uip-table">\n              <thead>\n                <tr class="">\n                  <th class="uip-padding-bottom-xxs"></th>\n                  <th class="uip-text-muted uip-text-weight-normal uip-text-right uip-padding-bottom-xxs">{{strings.sold}}</th>\n                  <th class="uip-text-right uip-text-muted uip-text-weight-normal uip-padding-bottom-xxs">{{strings.revenue}}</th>\n                </tr>\n              </thead>\n              <tbody>\n                <tr v-for="item in returnTableData">\n                  <td class="uip-text-bold uip-padding-bottom-xxs"><a class="uip-link-default uip-no-underline" :href="item.edit_url">{{item.name}}</a></td>\n                  <td class="uip-text-right uip-padding-bottom-xxs">{{item.total_sold}}</td>\n                  <td class="uip-text-right uip-padding-bottom-xxs">\n                    <div class=" uip-background-orange-wash uip-border-round uip-padding-xxxs uip-post-type-label uip-flex uip-gap-xxs uip-flex-center uip-text-bold uip-tag-label uip-inline-flex">\n                      <span class="">{{returnSymbolTotal(item.total)}}</span>\n                    </div>\n                  </td>\n                </tr>\n              </tbody>\n            </table>\n          </div>\n          <div class="uip-flex uip-flex-row uip-flex-between">\n            <div class="uip-text-s uip-text-muted uip-chart-label">{{chartData.labels.main[0]}}</div>\n            <div class="uip-text-s uip-text-muted uip-chart-label">{{chartData.labels.main[chartData.labels.main.length - 1]}}</div>\n          </div>\n        </div>\n      </div>\n\t\t </div>'}};